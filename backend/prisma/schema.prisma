generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id             String   @id @default(uuid())
  slug           String   @unique
  name           String
  
  // Branding
  primaryColor   String   @default("#10B981") // Emerald-500
  secondaryColor String   @default("#1F2937") // Gray-800
  logoUrl        String?
  restaurantUrl  String?
  nutritionDetails String? @db.Text
  
  users          User[]
  createdAt      DateTime @default(now())
}

model User {
  id           String            @id @default(uuid())
  email        String            @unique
  passwordHash String
  name         String
  role         Role              @default(USUARIO)
  
  // Multi-Tenancy
  organizationId String? // Optional for migration, enforce in logic
  organization   Organization? @relation(fields: [organizationId], references: [id])

  createdAt    DateTime          @default(now())
  profile      UserProfile?
  measurements UserMeasurement[]
  workoutPlans WorkoutPlan[]
  dietPlans    DietPlan[]
  notifications Notification[]
  isActive     Boolean           @default(true)
  acceptedTerms Boolean          @default(false)
}

model UserProfile {
  id                String       @id @default(uuid())
  userId            String       @unique
  user              User         @relation(fields: [userId], references: [id])
  age               Int
  gender            Gender
  height            Float
  weight            Float
  activityLevel     ActivityLevel
  fitnessGoal       FitnessGoal
  trainingDays      Int          @default(3)
  assignedTrainerId String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
}

model UserMeasurement {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  date           DateTime @default(now())
  
  // Bio
  age            Int
  gender         Gender
  heightCm       Float
  weightKg       Float
  
  // Goal & Activity
  goal           UserGoal
  trainingDays   Int
  
  // Measurements (cm)
  neck           Float
  chest          Float
  arm            Float
  waist          Float
  hips           Float
  glute          Float
  leg            Float
  
  // Computed Results
  bodyFat        Float?
  bmr            Float?
  tdee           Float?
  targetCalories Float?
}

model WorkoutPlan {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  trainerId String
  createdAt DateTime @default(now())
  exercises Json     // Storing list of WorkoutExercise as JSON
}

model DietPlan {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id])
  dailyCalories     Int
  proteinGrams      Int
  carbohydrateGrams Int
  fatGrams          Int
  createdAt         DateTime       @default(now())
  
  // Relations
  meals             DietMeal[]
}

model DietMeal {
  id          String     @id @default(uuid())
  dietPlanId  String
  dietPlan    DietPlan   @relation(fields: [dietPlanId], references: [id])
  name        String     // e.g., "Desayuno", "Almuerzo"
  order       Int        // 1, 2, 3...
  day         Int        @default(1) // 1-7
  foods       DietFood[]
}

model DietFood {
  id         String   @id @default(uuid())
  dietMealId String
  dietMeal   DietMeal @relation(fields: [dietMealId], references: [id])
  foodId     String
  food       FoodItem @relation(fields: [foodId], references: [id])
  portionGram Int
}

model FoodItem {
  id       String     @id @default(uuid())
  name     String
  category String     // e.g., "PROTEINA", "CARBOHIDRATO", "GRASA", "VEGETAL"
  calories Int        // per 100g
  protein  Float      // per 100g
  carbs    Float      // per 100g
  fat      Float      // per 100g
  
  dietFoods DietFood[]
}


model Exercise {
  id          String   @id @default(uuid())
  name        String
  muscleGroup String   // e.g., "PECHO", "ESPALDA", "PIERNA"
  bodyPart    String   // e.g., "TREN SUPERIOR", "TREN INFERIOR"
  createdAt   DateTime @default(now())
}

enum Role {
  USUARIO
  ADMINISTRADOR
  ENTRENADOR
  SUPERADMIN
}

enum Gender {
  MASCULINO
  FEMENINO
  OTRO
}

enum ActivityLevel {
  SEDENTARIO
  LIGERO
  MODERADO
  ACTIVO
  MUY_ACTIVO
}

enum FitnessGoal {
  PERDER_PESO
  GANAR_MUSCULO
  MANTENIMIENTO
}

enum UserGoal {
  VOLUMEN
  DEFINICION
  MANTENIMIENTO
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  user      User             @relation(fields: [userId], references: [id])
  title     String
  message   String
  type      NotificationType @default(SYSTEM)
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())
}

enum NotificationType {
  SYSTEM
  CLIENT_UPDATE
  PLAN_UPDATE
}
